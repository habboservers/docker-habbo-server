services:
  habbo-database:
    image: mariadb
    container_name: habbo-database
    restart: unless-stopped
    environment:
      MARIADB_ROOT_PASSWORD: "${MARIADB_ROOT_PASSWORD:-changeme}"
      MARIADB_DATABASE: "${HABBO_DATABASE_NAME:-havana}"
      MARIADB_USER: "${HABBO_DATABASE_USERNAME:-havana}"
      MARIADB_PASSWORD: "${HABBO_DATABASE_PASSWORD:-changeme}"
    ports:
      - "3306:3306"
    volumes:
      - ./database:/docker-entrypoint-initdb.d
      - mariadb_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
      start_period: 10s
      interval: 10s
      timeout: 5s
      retries: 3
    networks:
      - habboservers
    # Resource limits (adjust based on your environment)
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

  habbo-server:
    image: vitorvasc/docker-habbo-server:latest
    container_name: habbo-server
    restart: unless-stopped
    ports:
      - "80:80"
      - "12321:12321"
      - "12322:12322"
      - "12323:12323"
    volumes:
      - habboserver_data:/data
    depends_on:
      habbo-database:
        condition: service_healthy
    environment:
      HABBO_DATABASE_HOST: "${HABBO_DATABASE_HOST:-habbo-database}"
      HABBO_DATABASE_PORT: "${HABBO_DATABASE_PORT:-3306}"
      HABBO_DATABASE_USERNAME: "${HABBO_DATABASE_USERNAME:-havana}"
      HABBO_DATABASE_PASSWORD: "${HABBO_DATABASE_PASSWORD:-changeme}"
      HABBO_DATABASE_NAME: "${HABBO_DATABASE_NAME:-havana}"
      HABBO_WEBSERVER_STATIC_CONTENT_PATH: "${HABBO_WEBSERVER_STATIC_CONTENT_PATH:-https://cdn.habboservers.com/havana}"
    networks:
      - habboservers
    # Resource limits (adjust based on your environment)
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M

networks:
  habboservers:

volumes:
  habboserver_data:
  mariadb_data:
